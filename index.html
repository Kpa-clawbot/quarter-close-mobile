<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta property="og:title" content="Quarter Close">
  <meta property="og:description" content="An idle tycoon game disguised as a spreadsheet. Look busy. Get rich.">
  <meta property="og:image" content="https://kpa-clawbot.github.io/quarter-close/preview.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://kpa-clawbot.github.io/quarter-close/">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Quarter Close">
  <meta name="twitter:description" content="An idle tycoon game disguised as a spreadsheet. Look busy. Get rich.">
  <meta name="twitter:image" content="https://kpa-clawbot.github.io/quarter-close/preview.png">
  <meta name="description" content="An idle tycoon game disguised as a spreadsheet. Look busy. Get rich.">
  <title>Q4 Financials - Operations.xlsx - Quarter Close</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='4' fill='%23217346'/><rect x='4' y='4' width='7' height='5' rx='1' fill='white'/><rect x='13' y='4' width='7' height='5' rx='1' fill='white'/><rect x='22' y='4' width='7' height='5' rx='1' fill='white'/><rect x='4' y='11' width='7' height='5' rx='1' fill='white' opacity='0.8'/><rect x='13' y='11' width='7' height='5' rx='1' fill='white' opacity='0.8'/><rect x='22' y='11' width='7' height='5' rx='1' fill='white' opacity='0.8'/><rect x='4' y='18' width='7' height='5' rx='1' fill='white' opacity='0.6'/><rect x='13' y='18' width='7' height='5' rx='1' fill='white' opacity='0.6'/><rect x='22' y='18' width='7' height='5' rx='1' fill='white' opacity='0.6'/><rect x='4' y='25' width='7' height='5' rx='1' fill='white' opacity='0.4'/><rect x='13' y='25' width='7' height='5' rx='1' fill='white' opacity='0.4'/><rect x='22' y='25' width='7' height='5' rx='1' fill='white' opacity='0.4'/></svg>">
  <link rel="stylesheet" href="style.css?v=15">
</head>
<body>
  <!-- ===== ARC SELECTION ===== -->
  <div id="arc-select" class="hidden">
    <div id="arc-container">
      <div id="arc-header">
        <div id="arc-title">ğŸ“Š Quarter Close</div>
        <div id="arc-subtitle">Choose your business path</div>
      </div>
      <div id="arc-options"></div>
      <div id="arc-footer">Build your empire. Look like you're working.</div>
    </div>
  </div>

  <!-- ===== GAME VIEW ===== -->
  <div id="game-view" class="hidden">
    <!-- Title Bar -->
    <div id="title-bar">
      <div id="title-left">
        <span id="title-icon">
          <svg width="16" height="16" viewBox="0 0 32 32"><rect width="32" height="32" rx="4" fill="#217346"/><rect x='4' y='4' width='7' height='5' rx='1' fill='white'/><rect x='13' y='4' width='7' height='5' rx='1' fill='white'/><rect x='22' y='4' width='7' height='5' rx='1' fill='white'/><rect x='4' y='13' width='7' height='5' rx='1' fill='white' opacity='0.7'/><rect x='13' y='13' width='7' height='5' rx='1' fill='white' opacity='0.7'/><rect x='22' y='13' width='7' height='5' rx='1' fill='white' opacity='0.7'/></svg>
        </span>
        <span id="title-text">Q4 Financials - Operations.xlsx</span>
      </div>
      <div id="title-right">
        <span class="title-btn">â”€</span>
        <span class="title-btn">â–¡</span>
        <span class="title-btn title-close">âœ•</span>
      </div>
    </div>

    <!-- Ribbon / Menu Bar -->
    <div id="menu-bar">
      <span class="menu-item" id="file-menu" onclick="toggleFileMenu(event)">File
        <div class="menu-dropdown" id="file-dropdown">
          <div class="menu-dropdown-item" onclick="saveGame()">Save <span class="shortcut">Ctrl+S</span></div>
          <div class="menu-dropdown-sep"></div>
          <div class="menu-dropdown-item toggle" id="autosave-toggle" onclick="toggleAutosave(event)">Auto-save</div>
          <div class="menu-dropdown-sep"></div>
          <div class="menu-dropdown-item" onclick="confirmNewGame()">New Game</div>
          <div class="menu-dropdown-sep"></div>
          <div class="menu-dropdown-item" onclick="showAbout()">About</div>
        </div>
      </span>
      <span class="menu-item">Home</span>
      <span class="menu-item">Insert</span>
      <span class="menu-item">Page Layout</span>
      <span class="menu-item">Formulas</span>
      <span class="menu-item">Data</span>
      <span class="menu-item">Review</span>
      <span class="menu-item">View</span>
      <span class="menu-item" onclick="showHelp()">Help</span>
    </div>

    <!-- Toolbar -->
    <div id="toolbar">
      <div class="toolbar-group">
        <button class="tool-btn" title="Undo">â†¶</button>
        <button class="tool-btn" title="Redo">â†·</button>
        <div class="toolbar-sep"></div>
        <select class="tool-select font-select">
          <option>Calibri</option>
          <option>Arial</option>
          <option>Times New Roman</option>
        </select>
        <select class="tool-select size-select">
          <option>11</option>
          <option>12</option>
          <option>14</option>
        </select>
        <div class="toolbar-sep"></div>
        <button class="tool-btn" title="Bold"><b>B</b></button>
        <button class="tool-btn" title="Italic"><i>I</i></button>
        <button class="tool-btn" title="Underline"><u>U</u></button>
        <div class="toolbar-sep"></div>
        <button class="tool-btn" title="Align Left">â‰¡</button>
        <button class="tool-btn" title="Align Center">â‰¡</button>
        <button class="tool-btn" title="Align Right">â‰¡</button>
        <div class="toolbar-sep"></div>
        <button class="tool-btn" title="Currency">$</button>
        <button class="tool-btn" title="Percent">%</button>
        <button class="tool-btn" title="Comma">,</button>
      </div>
    </div>

    <!-- Formula Bar -->
    <div id="formula-bar">
      <div id="cell-ref">D1</div>
      <div id="fx-label">fx</div>
      <div id="formula-input">=SUM(D2:D9)</div>
    </div>

    <!-- Mini-task bar (sits between formula bar and grid) -->
    <div id="mini-task-bar" class="hidden">
      <span id="mini-task-text"></span>
      <span id="mini-task-reward"></span>
      <button class="mini-task-btn" onclick="completeMiniTask()">âœ” Approve</button>
      <button class="mini-task-skip" onclick="skipMiniTask()">âœ•</button>
    </div>

    <!-- Spreadsheet Grid -->
    <div id="grid-container">
      <!-- Column Headers (inside grid for shared column sizing) -->
      <div id="col-headers" class="grid-row">
        <div class="row-num-header"></div>
        <div class="col-header">A</div>
        <div class="col-header">B</div>
        <div class="col-header">C</div>
        <div class="col-header">D</div>
        <div class="col-header">E</div>
        <div class="col-header">F</div>
        <div class="col-header col-g">G</div>
        <div class="col-header col-h">H</div>
      </div>
      <!-- Row 1: Header / Cash -->
      <div class="grid-row header-row" id="row-1">
        <div class="row-num">1</div>
        <div class="cell cell-a header-cell">DEPARTMENT</div>
        <div class="cell cell-b header-cell">Staff</div>
        <div class="cell cell-c header-cell">Rev/day</div>
        <div class="cell cell-d header-cell"></div>
        <div class="cell cell-e header-cell"></div>
        <div class="cell cell-f header-cell"></div>
        <div class="cell cell-g header-cell">Rev/yr</div>
        <div class="cell cell-h empty-cell"></div>
      </div>

      <!-- Row 2: Cash display + Per-day -->
      <div class="grid-row" id="row-cash">
        <div class="row-num">2</div>
        <div class="cell cell-a cash-label">Total Cash</div>
        <div class="cell cell-b" id="stock-price-cell"></div>
        <div class="cell cell-c"></div>
        <div class="cell cell-d cash-value" id="cash-display">$0.00</div>
        <div class="cell cell-e per-tick-value" id="per-tick-display">$0.00/day</div>
        <div class="cell cell-f rev-label">Total Rev/yr:</div>
        <div class="cell cell-g rev-value" id="total-rev">$0.00</div>
        <div class="cell cell-h empty-cell"></div>
      </div>

      <!-- Separator row -->
      <div class="grid-row" id="row-sep">
        <div class="row-num">3</div>
        <div class="cell cell-a sep-cell"></div>
        <div class="cell cell-b sep-cell"></div>
        <div class="cell cell-c sep-cell"></div>
        <div class="cell cell-d sep-cell"></div>
        <div class="cell cell-e sep-cell"></div>
        <div class="cell cell-f sep-cell"></div>
        <div class="cell cell-g sep-cell"></div>
        <div class="cell cell-h sep-cell"></div>
      </div>

      <!-- Revenue source rows (dynamically populated) -->
      <div id="revenue-rows"></div>

      <!-- Empty filler rows to look like real spreadsheet -->
      <!-- Tax rows rendered as grid rows by JS -->
      <div id="tax-panel" class="hidden"></div>

      <!-- Board Room (RE Prestige Shop, post-IPO) -->
      <div id="board-room-rows" class="hidden"></div>

      <div id="filler-rows"></div>
    </div>

    <!-- Valuation chart (floating overlay like an Excel chart object) -->
    <div id="valuation-chart-container" class="hidden">
      <div class="chart-title">Company Valuation</div>
      <canvas id="valuation-chart"></canvas>
      <div class="chart-resize-handle"></div>
    </div>

    <!-- Revenue Breakdown -->
    <div id="revenue-breakdown">
      <span class="rb-label">Revenue:</span>
      <span class="rb-val" id="stat-sec"></span>
      <span class="rb-sep">â”‚</span>
      <span class="rb-val" id="stat-min"></span>
      <span class="rb-sep">â”‚</span>
      <span class="rb-val" id="stat-hr"></span>
      <span class="rb-sep">â”‚</span>
      <span class="rb-val" id="stat-day"></span>
      <span style="margin-left:auto"><button class="cell-btn btn-max" onclick="triggerIRS()" style="color:#c00">ğŸ§ª IRS</button> <button class="cell-btn btn-max" onclick="triggerBonus()" style="color:#217346">ğŸ§ª 5Ã—</button> <button class="cell-btn btn-max" onclick="forceIPO()" style="color:#0078d4">ğŸ§ª IPO</button> <button class="cell-btn btn-max" onclick="resetBoardRoom()" style="color:#7b1fa2">ğŸ§ª Reset BR</button></span>
    </div>

    <!-- Sheet Tabs -->
    <div id="sheet-tabs">
      <div class="sheet-tab active" id="tab-operations" onclick="switchTab('operations')">Operations</div>
      <div class="sheet-tab disabled" title="Unlocks at Series A">Sales</div>
      <div class="sheet-tab disabled" title="Unlocks at Series A">R&D</div>
      <div class="sheet-tab hidden" id="tab-board-room" onclick="switchTab('boardroom')">Board Room</div>
      <div class="sheet-tab add-tab">+</div>
      <div id="tab-spacer"></div>
    </div>

    <!-- Status Bar -->
    <div id="status-bar">
      <div id="status-left">
        <span id="status-text">Ready</span>
        <span class="status-sep">|</span>
        <span id="game-date">Jan 1, 2024</span>
        <span class="status-sep">|</span>
        <span id="status-timescale">â©â© 1 day/s</span>
      </div>
      <div id="status-center">
        <span id="status-save" class="status-indicator">ğŸ’¾ Saved</span>
      </div>
      <div id="status-right">
        <span id="stock-ticker" class="hidden" style="color:#ffd700;font-weight:600"></span>
        <span class="status-sep" id="stock-sep">|</span>
        <span id="status-clicks">ğŸ–± 0</span>
        <span class="status-sep">|</span>
        <span id="status-time">â± 0:00</span>
        <span class="status-sep">|</span>
        <span id="status-zoom">100%</span>
      </div>
    </div>
  </div>

  <!-- ===== BOSS VIEW (Esc toggle) ===== -->
  <div id="boss-view" class="hidden">
    <div id="boss-title-bar">
      <div id="boss-title-left">
        <span id="boss-title-icon">
          <svg width="16" height="16" viewBox="0 0 32 32"><rect width="32" height="32" rx="4" fill="#217346"/><rect x='4' y='4' width='7' height='5' rx='1' fill='white'/><rect x='13' y='4' width='7' height='5' rx='1' fill='white'/><rect x='22' y='4' width='7' height='5' rx='1' fill='white'/><rect x='4' y='13' width='7' height='5' rx='1' fill='white' opacity='0.7'/><rect x='13' y='13' width='7' height='5' rx='1' fill='white' opacity='0.7'/><rect x='22' y='13' width='7' height='5' rx='1' fill='white' opacity='0.7'/></svg>
        </span>
        <span>Book1 - Excel</span>
      </div>
      <div id="boss-title-right">
        <span class="title-btn">â”€</span>
        <span class="title-btn">â–¡</span>
        <span class="title-btn title-close">âœ•</span>
      </div>
    </div>
    <div id="boss-menu-bar">
      <span class="menu-item">File</span>
      <span class="menu-item">Home</span>
      <span class="menu-item">Insert</span>
      <span class="menu-item">Page Layout</span>
      <span class="menu-item">Formulas</span>
      <span class="menu-item">Data</span>
      <span class="menu-item">Review</span>
      <span class="menu-item">View</span>
      <span class="menu-item">Help</span>
    </div>
    <div id="boss-formula-bar">
      <div class="boss-cell-ref">A1</div>
      <div class="boss-fx">fx</div>
      <div class="boss-formula-input"></div>
    </div>
    <div id="boss-grid"></div>
    <div id="boss-sheet-tabs">
      <div class="sheet-tab active">Sheet1</div>
      <div class="sheet-tab">Sheet2</div>
      <div class="sheet-tab">Sheet3</div>
      <div class="sheet-tab add-tab">+</div>
    </div>
    <div id="boss-status-bar">
      <span>Ready</span>
      <span style="margin-left:auto">100%</span>
    </div>
  </div>

  <!-- ===== EVENT TOAST ===== -->
  <div id="event-toast" class="hidden">
    <div id="toast-header">
      <div id="toast-icon">âœ‰ï¸</div>
      <div id="toast-title">Notifications</div>
      <div id="toast-close" onclick="dismissEvent()">âœ•</div>
    </div>
    <div id="toast-sender"></div>
    <div id="toast-body"></div>
    <div id="toast-actions"></div>
  </div>

  <!-- ===== OFFLINE MODAL ===== -->
  <div id="offline-modal" class="hidden">
    <div id="offline-content">
      <div id="offline-header">ğŸ“Š Welcome back!</div>
      <div id="offline-body"></div>
      <button id="offline-ok" onclick="dismissOffline()">OK</button>
    </div>
  </div>

  <!-- ===== SERIES A MODAL ===== -->
  <div id="series-a-modal" class="hidden">
    <div id="series-a-content">
      <div id="series-a-header">ğŸ“§ New Email: Series A Offer</div>
      <div id="series-a-body">
        <p><strong>From:</strong> Jennifer Walsh &lt;jwalsh@sequoiacap.com&gt;</p>
        <p><strong>Subject:</strong> Congratulations â€” Let's talk Series A</p>
        <hr>
        <p>Hi,</p>
        <p>We've been tracking your growth and are impressed. Your revenue numbers are turning heads.</p>
        <p>We'd like to offer a <strong>$5M Series A</strong> investment at a generous valuation.</p>
        <p>The funds are yours â€” use them to scale faster.</p>
        <p><em>â€” Jennifer Walsh, Partner<br>Sequoia Capital</em></p>
        <hr>
        <p class="series-a-teaser">ğŸ’° <strong>$5,000,000 deposited.</strong></p>
        <p class="series-a-sub">Next milestone: IPO. Keep growing.</p>
      </div>
      <button id="series-a-ok" onclick="dismissSeriesA()">Back to Work</button>
    </div>
  </div>

  <!-- ===== ABOUT MODAL ===== -->
  <div id="about-modal" class="hidden">
    <div id="about-content">
      <h3>ğŸ“Š Quarter Close</h3>
      <p>v0.3.0 â€” Phase 2.2: Board Room</p>
      <p>An idle tycoon game disguised as a spreadsheet.</p>
      <p style="margin-top:12px;color:#999;">Build your empire. Look like you're working.</p>
      <button onclick="dismissAbout()">OK</button>
    </div>
  </div>

  <!-- ===== HELP MODAL ===== -->
  <div id="help-modal" class="hidden">
    <div id="help-content">
      <div class="help-header">
        <h3>ğŸ“Š Quarter Close â€” Help</h3>
        <button class="help-close" onclick="dismissHelp()">âœ•</button>
      </div>
      <div class="help-body">
        <div class="help-section">
          <h4>ğŸ¯ Goal</h4>
          <p>Build a company from nothing. Start with a lemonade stand, end with a tech empire. The spreadsheet is your cover â€” it looks like you're working.</p>
        </div>

        <div class="help-section">
          <h4>ğŸ’° Making Money</h4>
          <p><b>Click "Collect"</b> on a department to grab its pending revenue. Early on, clicking is your main income.</p>
          <p><b>Hire employees</b> to increase a department's revenue per day. More staff = more money.</p>
          <p><b>Upgrade</b> departments to multiply each employee's output (2Ã—, 4Ã—, 8Ã—...).</p>
          <p><b>Automate</b> a department so it collects revenue automatically â€” no clicking needed.</p>
          <p><b>Unlock new departments</b> as you earn enough. Higher tiers earn exponentially more.</p>
        </div>

        <div class="help-section">
          <h4>ğŸ“‹ Mini-Tasks</h4>
          <p>Desktop-style task notifications pop up periodically. Click <b>âœ” Approve</b> for bonus cash. They auto-expire in 10 seconds â€” if you miss it, your streak resets.</p>
          <p><b>Streaks:</b> 3 in a row = 1.5Ã— reward, 5 = 2Ã—, 10 = 3Ã—.</p>
        </div>

        <div class="help-section">
          <h4>ğŸ“§ Events</h4>
          <p>Random events pop up as desktop-style toasts (Mom's investment, angry customers, viral TikTok moments). Each has a 10-second timer â€” the last option auto-fires if you don't choose.</p>
          <p><b>Golden cells</b> occasionally glow gold in the grid â€” click them fast for a big bonus!</p>
        </div>

        <div class="help-section">
          <h4>ğŸ›ï¸ Taxes</h4>
          <p>Every 90 game-days, the IRS sends a quarterly tax bill.</p>
          <p><b>Regular tax:</b> 25% of (Revenue âˆ’ Depreciation).</p>
          <p><b>AMT floor:</b> You always pay at least 15% of gross revenue â€” no deducting your way to zero.</p>
          <p><b>Pay or ignore</b> â€” but ignored bills accrue 1% daily interest and escalate: Notice â†’ 2nd Notice â†’ Garnishment (âˆ’15% revenue) â†’ Asset Seizure.</p>
          <p><b>Depreciation:</b> Capital spending (hires, upgrades, automation) is deducted over 4 quarters, not immediately.</p>
        </div>

        <div class="help-section">
          <h4>ğŸ“ˆ Valuation Chart</h4>
          <p>The floating chart shows your company's valuation over time. Drag to move, resize from the corner. Valuation = Cash + (Annual Revenue Ã— market multiple).</p>
        </div>

        <div class="help-section">
          <h4>âŒ¨ï¸ Tips</h4>
          <p><b>Esc</b> â€” Boss key! Switches to a fake empty spreadsheet instantly.</p>
          <p><b>Ctrl+S</b> â€” Save game. Auto-save is on by default.</p>
          <p><b>File â†’ New Game</b> â€” Start over with a different career path.</p>
          <p><b>Click any cell</b> to see its reference in the formula bar (just like Excel).</p>
        </div>

        <div class="help-section">
          <h4>ğŸ”¢ Max Buttons</h4>
          <p>When you can afford 2+ hires or upgrades, a <b>Max(N)</b> link appears â€” click it to buy them all at once.</p>
        </div>

        <div class="help-section">
          <h4>ğŸ¢ Board Room (Post-IPO)</h4>
          <p>After going public, the <b>Board Room</b> tab unlocks. Spend <b>Retained Earnings (RE)</b> on permanent upgrades:</p>
          <p><b>Finance Dept</b> â€” auto-handles quarterly earnings. Three levels with increasing intelligence:</p>
          <p style="margin-left:16px"><b>Lv1 "The Intern"</b> â€” randomizes guidance (often wrong, but no more popups).</p>
          <p style="margin-left:16px"><b>Lv2 "Competent CFO"</b> â€” analyzes revenue trends, picks smartly ~70% of the time.</p>
          <p style="margin-left:16px"><b>Lv3 "Elite CFO"</b> â€” factors in streaks, bonuses, and analyst pressure. ~90% optimal.</p>
          <p style="margin-left:16px">You can switch between owned levels anytime in the IR section.</p>
          <p><b>Revenue Multipliers</b> â€” permanent boosts that stack (1.1Ã— â†’ 1.25Ã— â†’ 1.5Ã—).</p>
          <p><b>Lobbyist / Tax Haven</b> â€” reduce your tax rate (25% â†’ 20% â†’ 15%).</p>
          <p><b>Analyst Relations</b> â€” slows the analyst expectation ratchet by 50%.</p>
          <p><b>Golden Parachute</b> â€” protects against IRS asset seizure (consumed on use, rebuyable).</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== CONFIRM MODAL ===== -->
  <div id="confirm-modal" class="hidden">
    <div id="confirm-content">
      <p id="confirm-text">Are you sure?</p>
      <div id="confirm-buttons">
        <button onclick="dismissConfirm()">Cancel</button>
        <button class="confirm-danger" id="confirm-ok" onclick="confirmAction()">Yes, start over</button>
      </div>
    </div>
  </div>

  <script src="game.js?v=15"></script>
  <script>
    if (location.hostname === 'kpa-clawbot.github.io') {
      var s = document.createElement('script');
      s.async = true;
      s.dataset.goatcounter = 'https://quarter-close.goatcounter.com/count';
      s.src = '//gc.zgo.at/count.js';
      document.body.appendChild(s);
    }
  </script>
</body>
</html>
